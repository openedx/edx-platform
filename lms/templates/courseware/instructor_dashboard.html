<%inherit file="/main.html" />
<%! from django.core.urlresolvers import reverse %>
<%namespace name='static' file='/static_content.html'/>

<%block name="headextra">
  <%static:css group='course'/>
  <script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.axislabels.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/jquery-jvectormap-1.1.1/jquery-jvectormap-1.1.1.min.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/jquery-jvectormap-1.1.1/jquery-jvectormap-world-mill-en.js')}"></script>
</%block>

<%include file="/courseware/course_navigation.html" args="active_page='instructor'" />

<style type="text/css">
table.stat_table {
	font-family: verdana,arial,sans-serif;
	font-size:11px;
	color:#333333;
	border-width: 1px;
	border-color: #666666;
	border-collapse: collapse;
}
table.stat_table th {
	border-width: 1px;
	padding: 8px;
	border-style: solid;
	border-color: #666666;
	background-color: #dedede;
}
table.stat_table td {
	border-width: 1px;
	padding: 8px;
	border-style: solid;
	border-color: #666666;
	background-color: #ffffff;
}
.divScroll {  
	height: 200px;  
	overflow: scroll;  
}  

a.selectedmode { background-color: yellow; }


.jvectormap-label {
    position: absolute;
    display: none;
    border: solid 1px #CDCDCD;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
    background: #292929;
    color: white;
    font-family: sans-serif, Verdana;
    font-size: smaller;
    padding: 3px;
}

.jvectormap-zoomin, .jvectormap-zoomout {
    position: absolute;
    left: 10px;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
    background: #292929;
    padding: 3px;
    color: white;
    width: 10px;
    height: 10px;
    cursor: pointer;
    line-height: 10px;
    text-align: center;
}

.jvectormap-zoomin {
    top: 10px;
}

.jvectormap-zoomout {
    top: 30px;
}

</style>

<script language="JavaScript" type="text/javascript">
function goto( mode)
{
  document.idashform.idash_mode.value = mode;
  document.idashform.submit() ;
}
</script>

<section class="container">
<div class="instructor-dashboard-wrapper">

  <section class="instructor-dashboard-content">
    <h1>Instructor Dashboard</h1>

    <h2>[ <a href="#" onclick="goto('Grades');" class="${modeflag.get('Grades')}">Grades</a> | 
          %if settings.MITX_FEATURES.get('ENABLE_PSYCHOMETRICS'):
            <a href="#" onclick="goto('Psychometrics');" class="${modeflag.get('Psychometrics')}">Psychometrics</a> | 
          %endif
          <a href="#" onclick="goto('Admin');" class="${modeflag.get('Admin')}">Admin</a> |
          <a href="#" onclick="goto('Forum Admin');" class="${modeflag.get('Forum Admin')}">Forum Admin</a>
          %if settings.MITX_FEATURES.get('ENABLE_INSTRUCTOR_ANALYTICS'):
             | <a href="#" onclick="goto('Analytics');" class="${modeflag.get('Analytics')}">Analytics</a> 
          %endif
	  ]
    </h2>

  <div style="text-align:right" id="djangopid">${djangopid}</div>

    <form name="idashform" method="POST">
    <input type="hidden" name="csrfmiddlewaretoken" value="${ csrf_token }">
    <input type="hidden" name="idash_mode" value="">

##----------------------------------------------------------------------------- 
%if modeflag.get('Grades'):
    <p>
    <a href="${reverse('gradebook', kwargs=dict(course_id=course.id))}">Gradebook</a>
    </p>

    <p>
    <a href="${reverse('grade_summary', kwargs=dict(course_id=course.id))}">Grade summary</a>
    </p>

    <p>
    <input type="submit" name="action" value="Dump list of enrolled students">
    </p>

    <p>
    <input type="submit" name="action" value="Dump Grades for all students in this course">
    <input type="submit" name="action" value="Download CSV of all student grades for this course">
    </p>

    <p>
    <input type="submit" name="action" value="Dump all RAW grades for all students in this course">
    <input type="submit" name="action" value="Download CSV of all RAW grades">
    </p>

    <p>
    <input type="submit" name="action" value="Download CSV of answer distributions">
    </p>
 %endif

##----------------------------------------------------------------------------- 
%if modeflag.get('Psychometrics'):

    <p>Select a problem and an action:
    </p>

    <p>
    <select name="Problem">
    %for problem, count in sorted(problems.items(), key=lambda x: x[0]):
        <option value="${problem}">${problem} [${count}]</option>
    %endfor
    </select>
    </p>
    <p>
    <input type="submit" name="action" value="Generate Histogram and IRT Plot">
    </p>

    <p></p>

%endif

##----------------------------------------------------------------------------- 
%if modeflag.get('Admin'):
  %if instructor_access:
    <hr width="40%" style="align:left">
    <p>
    <input type="submit" name="action" value="List course staff members">
    <p>
    <input type="text" name="staffuser"> <input type="submit" name="action" value="Remove course staff">
    <input type="submit" name="action" value="Add course staff">
    <hr width="40%" style="align:left">
  %endif

  %if settings.MITX_FEATURES['ENABLE_MANUAL_GIT_RELOAD'] and admin_access:
    <p>
    <input type="submit" name="action" value="Reload course from XML files">
    <input type="submit" name="action" value="GIT pull and Reload course">
  %endif
%endif

##----------------------------------------------------------------------------- 
%if modeflag.get('Forum Admin'):
  %if instructor_access:
    <hr width="40%" style="align:left">
    <p>
    <input type="submit" name="action" value="List course forum admins">
    <p>
    <input type="text" name="forumadmin"> <input type="submit" name="action" value="Remove forum admin">
    <input type="submit" name="action" value="Add forum admin">
    <hr width="40%" style="align:left">
  %endif

  %if instructor_access or forum_admin_access:
    <p>
    <input type="submit" name="action" value="List course forum moderators">
    <input type="submit" name="action" value="List course forum community TAs">
    <p>
    <input type="text" name="forummoderator"> 
    <input type="submit" name="action" value="Remove forum moderator">
    <input type="submit" name="action" value="Add forum moderator">
    <input type="submit" name="action" value="Remove forum community TA">
    <input type="submit" name="action" value="Add forum community TA">
    <hr width="40%" style="align:left">
  %else:
  <p>User requires forum administrator privileges to perform administration tasks.  See instructor.</p>
  %endif
%endif

    </form>

##----------------------------------------------------------------------------- 
%if modeflag.get('Analytics'):

   <p>
     Number of students enrolled:
     % if students_enrolled_json is not None:
     % if students_enrolled_json['status'] == 'success':
     ${students_enrolled_json['data']['value']}
     % else:
     <i> ${students_enrolled_json['error']} </i>
     % endif
     % else:
     <i> null data </i>
     % endif
   </p>

   <p>
     Number of active students for the past 7 days: 
     % if students_active_json is not None:
     % if students_active_json['status'] == 'success':
     ${students_active_json['data']['value']}
     % else:
     <i> ${students_active_json['error']} </i>
     % endif
     % else:
     <i> null data </i>
     % endif
   </p>

   <p>
     Student distribution per country, all courses, Sep-12 to Oct-17, 1 server (shown here as an example):
   </p>

<div id="posts-list" class="clearfix">
<figure>
    <div id="world-map-students" style="width: 720px; height: 400px"></div>
    <script>
      var student_data = {BD : '300', BE : '156', BF : '7', BG : '246', BA : '62', BB : '1', BN : '7', BO : '61', JP : '153', BI : '4', BJ : '6', BT : '11', JM : '32', JO : '67', WS : '1', BR : '1941', BS : '5', JE : '6', BY : '166', BZ : '4', RU : '1907', RW : '50', RS : '128', TL : '1', RE : '2', A2 : '59', TJ : '9', RO : '232', GU : '3', GT : '76', GR : '565', BH : '22', GY : '6', GG : '2', GF : '1', GE : '22', GD : '7', GB : '2023', GA : '4', GM : '18', GL : '2', GI : '1', GH : '393', OM : '25', TN : '143', BW : '26', HR : '76', HT : '38', HU : '259', HK : '103', HN : '51', AD : '1', PR : '40', PS : '38', PT : '487', PY : '38', PA : '21', PG : '11', PE : '342', PK : '1833', PH : '571', TM : '1', PL : '736', ZM : '61', EE : '67', EG : '961', ZA : '184', EC : '118', AL : '44', AO : '10', SB : '2', EU : '183', ET : '153', SO : '1', ZW : '42', KY : '3', ES : '1954', ER : '3', ME : '6', MD : '26', MG : '10', UY : '64', UZ : '40', MM : '21', ML : '4', MO : '3', MN : '49', US : '11899', MU : '11', MT : '15', MW : '41', MV : '5', MP : '4', MR : '1', IM : '2', UG : '133', MY : '207', MX : '844', AT : '83', FR : '446', MA : '175', A1 : '167', AX : '1', FI : '97', FJ : '9', NI : '23', NL : '240', NO : '110', NA : '27', NC : '1', NE : '4', NG : '753', NZ : '98', NP : '200', CI : '9', CH : '144', CO : '851', CN : '282', CM : '82', CL : '243', CA : '1129', CD : '7', CZ : '161', CY : '26', CR : '137', CV : '11', CU : '15', SZ : '6', SY : '58', KG : '47', KE : '282', SR : '5', KI : '1', KH : '40', SV : '155', KM : '1', ST : '1', SK : '66', KR : '141', SI : '70', KP : '1', KW : '28', SN : '16', SL : '11', KZ : '174', SA : '352', SG : '217', SE : '172', SD : '61', DO : '104', DM : '5', DJ : '6', DK : '105', DE : '941', YE : '90', DZ : '281', MK : '28', TZ : '124', LC : '5', LA : '7', TW : '115', TT : '33', TR : '288', LK : '96', LV : '52', TO : '2', LT : '114', LU : '21', LR : '9', LS : '9', TH : '84', TG : '11', LY : '15', VC : '6', AE : '151', VE : '180', AG : '1', AF : '21', IQ : '29', VI : '1', IS : '14', IR : '153', AM : '37', IT : '365', VN : '269', AP : '23', AR : '258', AU : '661', IL : '159', AW : '3', IN : '7836', LB : '28', AZ : '22', IE : '210', ID : '382', UA : '860', QA : '23', MZ : '8'};
      $(function(){
        $('#world-map-students').vectorMap({
          map: 'world_mill_en',
          backgroundColor: '#eeeeee',
          series: {
            regions: [{
              values: student_data,
              scale: ['#C8EEFF', '#0071A4'],
              normalizeFunction: 'polynomial'
            }]
          },
          onRegionLabelShow: function(event, label, code){
            label.text(label.text() + ': ' + (student_data[code] != null ? student_data[code] : 0));
          }
        });
      });
    </script>
</figure>
</div>

   <p>
     <p>Number of active students per problems who have this problem graded as correct:</p>

     % if students_per_problem_correct_json is not None:
     % if students_per_problem_correct_json['status'] == 'success':
     <div class="divScroll">
     <table class="stat_table">
     <tr><th>Problem</th><th>Number of students</th></tr>
     % for k,v in students_per_problem_correct_json['data'].items():
     <tr> <td>${k}</td> <td>${v}</td> </tr>
     % endfor
     </table>
     </div>
     % else:
     <i> ${students_per_problem_correct_json['error']}</i>
     % endif
     % else:
     <i> null data </i>
     % endif
   </p>

##   <p>
##     <p>Students who attempted at least one exercise:</p>
##
##     % if attempted_problems is not None:
##     % if attempted_problems['status'] == 'success':
##     <div class="divScroll">
##     <table class="stat_table">
##     <tr><th>Module</th><th>Number of students</th></tr>
##     % for k,v in attempted_problems['data'].items():
##     <tr> <td>${k}</td> <td>${v}</td> </tr>
##     % endfor
##     </table>
##     </div>
##     % else:
##     <i> ${attempted_problems['error']}</i>
##     % endif
##     % else:
##     <i> null data </i>
##     % endif
##   </p>
##
##   <p>
##     <p>Number of students who dropped off per day before becoming inactive:</p>
##
##     % if dropoff_per_day is not None:
##     % if dropoff_per_day['status'] == 'success':
##     <div class="divScroll">
##     <table class="stat_table">
##     <tr><th>Day</th><th>Number of students</th></tr>
##     % for k,v in dropoff_per_day['data'].items():
##     <tr> <td>${k}</td> <td>${v}</td> </tr>
##     % endfor
##     </table>
##     </div>
##     % else:
##     <i> ${dropoff_per_day['error']}</i>
##     % endif
##     % else:
##     <i> null data </i>
##     % endif
##   </p>
##
##   <p>
##     <p>Grade distribution:</p>
##
##     % if overall_grade_distribution is not None:
##     % if overall_grade_distribution['status'] == 'success':
##     <div class="divScroll">
##     <table class="stat_table">
##     <tr><th>Grade</th><th>Number of students</th></tr>
##     % for k,v in overall_grade_distribution['data'].items():
##     <tr> <td>${k}</td> <td>${v}</td> </tr>
##     % endfor
##     </table>
##     </div>
##     % else:
##     <i> ${dropoff_per_day['error']}</i>
##     % endif
##     % else:
##     <i> null data </i>
##     % endif
##   </p>


##   <p>
##     <h2>Daily activity (online version):</h2>
##     <table class="stat_table">
##     <tr><th>Day</td><th>Number of students</td></tr>
##     % for k,v in daily_activity_json['data'].items():
##     <tr>
##     <td>${k}</td> <td>${v}</td>
##     </tr>
##     % endfor
##     </table>
##   </p>


%endif

##----------------------------------------------------------------------------- 
%if modeflag.get('Psychometrics') is None:

    <br/>
    <br/>
    <p>
      <hr width="100%">
      <h2>${datatable['title']}</h2>
      <table class="stat_table">
        <tr>
	%for hname in datatable['header']:
	  <th>${hname}</th>
	%endfor
	</tr>
        %for row in datatable['data']:
          <tr>
	    %for value in row:
	      <td>${value}</td>
	    %endfor
	  </tr>
        %endfor
      </table>
    </p>
%endif

##-----------------------------------------------------------------------------  
%if modeflag.get('Psychometrics'):

    %for plot in plots:
      <br/>
      <h3>${plot['title']}</h3>
      <br/>
      <p>${plot['info']}</p>
      <br/>
      <div id="plot_${plot['id']}" style="width:600px;height:300px;"></div>
      <script type="text/javascript">
          $(function () {
              ${plot['data']}
              $.plot($("#plot_${plot['id']}"), ${plot['cmd']}  );
          });
      </script>
      <br/>
      <br/>
    %endfor

%endif
 
##-----------------------------------------------------------------------------  
## always show msg

%if msg:
    <p>${msg}</p>
%endif

##----------------------------------------------------------------------------- 
%if modeflag.get('Admin'):
 % if course_errors is not UNDEFINED:
    <h2>Course errors</h2>
    <div id="course-errors">
    %if not course_errors:
          None
    %else:
      <ul>
        % for (summary, err) in course_errors:
        <li>${summary | h}
        % if err:
          <ul><li><pre>${err | h}</pre></li></ul>
        % else:
          <p>&nbsp;</p>
        % endif
        </li>
        % endfor
        </ul>
      %endif
      </div>
  % endif
%endif      

  </section>
</div>
</section>
