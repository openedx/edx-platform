# -*- coding: utf-8 -*-
<%! 
from django.utils.translation import ugettext as _ 
from util.date_utils import get_time_display
from django.conf import settings
%>

<%namespace name='static' file='/static_content.html'/>
  <script type="text/javascript" src="${static.url('js/vendor/tiny_mce/tiny_mce.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/tiny_mce/jquery.tinymce.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/CodeMirror/htmlmixed.js')}"></script>
  <script type="text/javascript" src="${static.url('js/vendor/CodeMirror/css.js')}"></script>
  <script type="text/javascript">
    (function() {window.baseUrl = "${settings.STATIC_URL}";})(this);
  </script>
  <%static:js group='module-descriptor-js'/>

<style>
.xmodule_edit ul {
margin: 0 !important;
padding: 0 !important;
margin-bottom: 10px !important;
list-style: none !important;
}
</style>

<section
    id="master_class_${element_id}"
    class="${element_class}"
    data-ajax-url="${ajax_url}"
>
    <h2 class="problem-header">${display_name}</h2>
<%
    formatted_string = get_time_display(due, "DATE_TIME", coerce_tz=settings.TIME_ZONE_DISPLAYED_FOR_DEADLINES)
    due_date = '' if len(formatted_string)==0 else (u'<h4>Дата окончания регистрации: {date}</h4>').format(date=formatted_string)
    %>
    
    ${due_date}
        <p>

    <section class="input_class_section">
        <input
                id="input-class"
                type="hidden"
                value="1"
            />
        <section class="action">
            <input class="save" type="button" value="${_('Register')}" />
        </section>
    </section>
    <p>
    <section id="result_class_section_${element_id}" class="result_class_section">
        <p><span class="message"></span></p>
        <h3>${_('Passed registration:')} <span class="total_register"></span></h3>
        <h3>${_('Total places:')} <span class="total_places"></span></h3>
        <div class="master_class"></div>
    </section>
    <p>
    % if is_staff:
    <section id="staff_information_section_${element_id}" class="staff_information_section sr">
    <h3>${_('Staff Inforamtion')}</h3>
    <h4>${_('Students pending registration')}</h4>
    <ul id="all_registrations" class="email_list">

    </ul>
    <h4>${_('Students passed registration')}</h4>
    <ul id="passed_registrations" class="email_list">

    </ul>

    </section>

    <section>
        <input class="email-send" type="button" value="Скачать CSV файл с регистрациями" />
    </section>

    <ul class="list-fields">
      <li class="field">
        <label for="id_subject">${_("Subject: ")}</label>
          <input type="text" id="id_subject" name="subject" maxlength="128" size="75">
        <span class="tip">${_("(Max 128 characters)")}</span>
      </li>

      <li class="field">
        <label>${_("Message:")}</label>
        <div class="email-editor">
            <div class="xblock xblock-studio_view xmodule_edit xmodule_HtmlDescriptor" data-runtime-class="LmsRuntime" data-init="XBlockToXModuleShim" data-block-type="None" data-runtime-version="1" data-usage-id="i4x:;_;_dummy_org;_dummy_course;_html;_dummy_name" data-type="HTMLEditingDescriptor" data-course-id="CPM/1/123" tabindex="0">
    

                <section class="html-editor editor">
                  <ul class="editor-tabs">
                    <li><a href="#" class="visual-tab tab current" data-tab="visual">Визуальный</a></li>
                    <li><a href="#" class="html-tab tab" data-tab="advanced">HTML</a></li>
                  </ul>

                  <div class="row">
                    <textarea class="tiny-mce"></textarea>
                    <textarea name="" class="edit-box"></textarea>
                  </div>
                </section>

                </div>
        </div>
        <input type="hidden" name="message" value="">
      </li>
    </ul>
    <script type="text/javascript">
    var emailEditor;
      $(document).ready(function(event){
        emailEditor = XBlock.initializeBlock($('.xblock-studio_view'));
      });
      function checkemail() {
          this.idashform.message.value = emailEditor.save()['data'];
          if (!this.idashform.subject.value) {
              alert("Тема сообщения не может быть пустой.");
              return false;
          } else if (!this.idashform.message.value) {
              alert("Сообщение не может быть пустым.");
              return false;
          } else {
              return true;
          }
        };
    </script>
    % endif

</section>
