<%page expression_filter="h"/>
<%!
from django.utils.translation import ugettext as _
from openedx.core.djangolib.js_utils import (
    dump_js_escaped_json, js_escaped_string
)
%>
<%namespace name='static' file='/static_content.html'/>

<%block name="jsextra">
  <script src="${static.url('common/js/vendor/backbone-min.js')}"></script>
  <script src="${static.url('js/vendor/timepicker/jquery.timepicker.js')}"></script>
  <link rel="stylesheet" type="text/css" href="${static.url('js/vendor/timepicker/jquery.timepicker.css')}" />
  <style>
    .ui-timepicker-list { z-index: 100000; }
    .ui-datepicker { z-index: 100000 !important; }
    input.date, input.time { width: auto !important; display: inline !important; }
  </style>
</%block>

<div id="ccx-schedule-container"></div>
<br/>
<section id="enter-date-modal" class="modal"
         tabindex="-1" role="dialog" aria-labelledby="ccx_schedule_set_date_heading">
  <div class="inner-wrapper">
    <button class="close-modal">
      <span class="icon fa fa-remove" aria-hidden="true"></span>
      <span class="sr">${_("Close")}</span>
    </button>
    <header>
      <h2 id="ccx_schedule_set_date_heading"></h2>
    </header>
    <form class="ccx-form">
      <div class="field" aria-live="assertive" aria-atomic="true" aria-relevant="text">
          <p class="request-response-error" id="date-modal-error-message" tabindex="-1" role="alert"></p>
      </div>
      <div class="field datepair">
        ## Translators: This explains to people using a screen reader how to interpret the format of YYYY-MM-DD
        <label class="sr form-label" for="ccx_dialog_date">${_('Date format four digit year dash two digit month dash two digit day')}</label>
        <input placeholder="${_('Date')}" class="date" type="text" name="date" id="ccx_dialog_date" size="11" />
        ## Translators: This explains to people using a screen reader how to interpret the format of HH:MM
        <label class="sr form-label" for="ccx_dialog_time">${_('Time format two digit hours colon two digit minutes')}</label>
        <input placeholder="${_('Time')}" class="time" type="text" name="time" id="ccx_dialog_time" size="6" />
      </div>
      <div class="field">
        <button class="btn btn-primary" id="date-picker-dialog-btn">${_('Set date')}</button>
      </div>
    </form>
  </div>
</div>

<script>
$(function() {
    var require = window.require || RequireJS.require;
    require([
      "js/ccx/ccx_schedule_factory", "jquery"
    ], function(CcxScheduleFactory, $) {
      var schedule = JSON.parse(${schedule | n, dump_js_escaped_json});
      var view = new CcxScheduleFactory(
          $("#ccx-schedule-container"),
          schedule,
          "${save_url | n, js_escaped_string}"
      );
      view.render();
    });

    $('.datepair .time').timepicker({
        'showDuration': true,
        'timeFormat': 'G:i',
        'autoclose': true
    });

    $('.datepair .date').datepicker({
        'dateFormat': 'yy-mm-dd',
        'autoclose': true
    });

    $('.datepair .date').change(function() {
       var date = $(this).datepicker( "getDate" );
       if (date) {
           $(this).val($.datepicker.formatDate("yy-mm-dd", date));
       }
    });
});
</script>
