##This file is based on the template from the SimpleWiki source which carries the GPL license

<%inherit file="main.html"/>

<%block name="title"><title>${"wiki_title"}</title></%block>

<%block name="headextra">
<link rel="stylesheet" media="screen,print" href="/static/simplewiki/css/base.css" />
<link rel="stylesheet" media="print" href="/static/simplewiki/css/base_print.css" />
<link rel="stylesheet" href="/static/simplewiki/css/autosuggest_inquisitor.css" />
<link rel="stylesheet" href="/static/css/local.css" type="text/css" media="all" />
<script type="text/javascript" src="/static/simplewiki/js/bsn.AutoSuggest_c_2.0.js"></script>

<%!
    from django.core.urlresolvers import reverse
%>

<script type="text/javascript">
	function set_related_article_id(s) {
		document.getElementById('wiki_related_input_id').value = s.id;
		document.getElementById('wiki_related_input_submit').disabled=false;
	}
	%if wiki_article is not UNDEFINED:
	var x = window.onload;
	window.onload = function(){
			var options = {
			script: "${reverse("search_related", args=[wiki_article.get_url()] )}/?self=${wiki_article.pk}&",
			json: true,
			varname: "query",
			maxresults: 35,
			callback: set_related_article_id,
			noresults: "Nothing found!"
		};
		var as = new AutoSuggest('wiki_related_input', options);
		if (typeof x == 'function')
			x();
	}
	%endif
</script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {inlineMath: [ ['$','$'], ["\\(","\\)"]],
              displayMath: [ ['$$','$$'], ["\\[","\\]"]]}
  });
</script> <script type="text/javascript" src="/static/lib/mathjax/MathJax.js?config=TeX-AMS_HTML-full"></script> 
<script>
$(function(){
$.ajaxSetup ({
    // Disable caching of AJAX responses
    cache: false
});

$(".div_wiki_circuit").each(function(d,e) {
   id = $(this).attr("id");
   name = id.substring(17);
   //alert(name);
   $("#"+id).load("/edit_circuit/"+name);
   f=this;
});

update_schematics();});
</script>
<%block name="wiki_head"/>
</%block>

<%block name="bodyextra">

<%include file="navigation.html" />

<section class="main-content">
	<h1><%block name="wiki_page_title"/></h1>
	<hr />

	<%block name="wiki_panel">

	<div id="wiki_panel">
	    <div class="wiki_box">
	    	<div class="wiki_box_header">
	    		<div class="wiki_box_corner"></div>
	    		<div class="wiki_box_bar"></div>
	    	</div>
	    	<div class="wiki_box_contents" style="position: relative;">

	    	<div style="border: 2px outset #CCC; width: 250px; padding: 10px; background-color: #FFF; position: absolute; right: 100px; top: -80px; display: none; color: #000;" id="wiki_create_form">
				<%
					theaction = "this.wiki_article_name.value.replace(/([^a-zA-Z0-9\-])/g, '')+'/_create/'"
					if (wiki_article is not UNDEFINED):
						baseURL = reverse("wiki_view", args=[wiki_article.get_url()])
					else:
						baseURL = reverse("wiki_view", args=[""])
					
				%>
	    		<form method="GET" onsubmit="this.action='${baseURL + "/' + " + theaction};">
	    			<h2>Create article</h2>
	    			<p>
	    			    <label for="id_wiki_article_name">Title of article</label>
	    			    <input type="text" name="wiki_article_name" id="id_wiki_article_name" /><br/>
	    			    <label for="id_wiki_article_is_child">Create as a child of current article</label>
	    			    <input type="checkbox" name="wiki_article_is_child" id="id_wiki_artcile_is_child" disabled="true" ${ 'checked="checked"' if wiki_article is not UNDEFINED else ""}>
	    			</p>
	    			<p>
	    				<input type="button" class="button" value="Cancel" style="display: inline-block; margin-right: 2px;" onclick="document.getElementById('wiki_create_form').style.display='none';" />
	    				<input type="submit" class="button" value="Next &gt;" style="display: inline-block; margin-right: 2px; font-weight: bold;" />
	    			</p>
	    		</form>
	    	</div>
	    	<p>
    	
		    %if wiki_article is not UNDEFINED:
	    	    <input type="button" onclick="javascript:location.href='${reverse("wiki_view", args=[wiki_article.get_url()])}'" value="View" style="width: 100%;" class="button"  /><br />
	    	    <input type="button" onclick="javascript:location.href='${reverse("wiki_edit", args=[wiki_article.get_url()])}'" value="Edit" style="width: 100%;" class="button" ${'disabled="true"' if not wiki_write else ""}/><br />
	    	    <input type="button" onclick="javascript:location.href='${reverse("wiki_history", args=[wiki_article.get_url(),1])}'" value="History" style="width: 100%;" class="button" />
	    	%endif
	    	<input type="button" onclick="document.getElementById('wiki_create_form').style.display='block';" value="Create article" style="width: 100%; margin-bottom: 2px;" class="button" />
	    	<input type="button" onclick="javascript:location.href='${reverse("wiki_random", args=["wiki_articleget_url"])}'" value="Random article" style="width: 100%; margin-bottom: 2px;" class="button" />
	    	</p>
			%if wiki_article is not UNDEFINED:
				%if wiki_article.locked:
				<p><strong>This article has been locked</strong></p>
				%endif
				<p>
	    	        <i>Last modified: ${wiki_article.modified_on.strftime("%b %d, %Y, %I:%M %p")}</i>
	    	    </p>
			%endif
	    	</div>
	    	<div class="wiki_box_footer">
	    		<div class="wiki_box_corner"></div>
	    		<div class="wiki_box_bar"></div>
	    	</div>
	    </div>

	</div>

	</%block>

	<%block name="wiki_body"/>
</section>

</%block>
